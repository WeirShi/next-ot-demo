function t(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;var e="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},n="1.6.0",r=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var i=function(t){var e=new Set([t]),n=new Set,i=t.match(r);if(!i)return function(){return!1};var o=+i[1],s=+i[2],a=+i[3];if(null!=i[4])return function(e){return e===t};function u(t){return n.add(t),!1}function c(t){return e.add(t),!0}return function(t){if(e.has(t))return!0;if(n.has(t))return!1;var i=t.match(r);if(!i)return u(t);var l=+i[1],_=+i[2],p=+i[3];return null!=i[4]||o!==l?u(t):0===o?s===_&&a<=p?c(t):u(t):s<=_?c(t):u(t)}}(n),o=n.split(".")[0],s=Symbol.for("opentelemetry.js.api."+o),a=e;function u(t,e,r,i){var o;void 0===i&&(i=!1);var u=a[s]=null!==(o=a[s])&&void 0!==o?o:{version:n};if(!i&&u[t]){var c=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return r.error(c.stack||c.message),!1}if(u.version!==n){c=new Error("@opentelemetry/api: Registration of version v"+u.version+" for "+t+" does not match previously registered API v"+n);return r.error(c.stack||c.message),!1}return u[t]=e,r.debug("@opentelemetry/api: Registered a global for "+t+" v"+n+"."),!0}function c(t){var e,n,r=null===(e=a[s])||void 0===e?void 0:e.version;if(r&&i(r))return null===(n=a[s])||void 0===n?void 0:n[t]}function l(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+n+".");var r=a[s];r&&delete r[t]}var _,p=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},h=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},E=function(){function t(t){this._namespace=t.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d("debug",this._namespace,t)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d("error",this._namespace,t)},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d("info",this._namespace,t)},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d("warn",this._namespace,t)},t.prototype.verbose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d("verbose",this._namespace,t)},t}();function d(t,e,n){var r=c("diag");if(r)return n.unshift(e),r[t].apply(r,h([],p(n),!1))}!function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"}(_||(_={}));var f=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},T=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},g=function(){function t(){function t(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=c("diag");if(r)return r[t].apply(r,T([],f(e),!1))}}var e=this;e.setLogger=function(t,n){var r,i,o;if(void 0===n&&(n={logLevel:_.INFO}),t===e){var s=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return e.error(null!==(r=s.stack)&&void 0!==r?r:s.message),!1}"number"==typeof n&&(n={logLevel:n});var a=c("diag"),l=function(t,e){function n(n,r){var i=e[n];return"function"==typeof i&&t>=r?i.bind(e):function(){}}return t<_.NONE?t=_.NONE:t>_.ALL&&(t=_.ALL),e=e||{},{error:n("error",_.ERROR),warn:n("warn",_.WARN),info:n("info",_.INFO),debug:n("debug",_.DEBUG),verbose:n("verbose",_.VERBOSE)}}(null!==(i=n.logLevel)&&void 0!==i?i:_.INFO,t);if(a&&!n.suppressOverrideMessage){var p=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+p),l.warn("Current logger will overwrite one already registered from "+p)}return u("diag",l,e,!0)},e.disable=function(){l("diag",e)},e.createComponentLogger=function(t){return new E(t)},e.verbose=t("verbose"),e.debug=t("debug"),e.info=t("info"),e.warn=t("warn"),e.error=t("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),O=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},L=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},m=function(){function t(t){this._entries=t?new Map(t):new Map}return t.prototype.getEntry=function(t){var e=this._entries.get(t);if(e)return Object.assign({},e)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(t){var e=O(t,2);return[e[0],e[1]]}))},t.prototype.setEntry=function(e,n){var r=new t(this._entries);return r._entries.set(e,n),r},t.prototype.removeEntry=function(e){var n=new t(this._entries);return n._entries.delete(e),n},t.prototype.removeEntries=function(){for(var e,n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=new t(this._entries);try{for(var s=L(r),a=s.next();!a.done;a=s.next()){var u=a.value;o._entries.delete(u)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return o},t.prototype.clear=function(){return new t},t}(),S=Symbol("BaggageEntryMetadata"),R=g.instance();function v(t){return void 0===t&&(t={}),new m(new Map(Object.entries(t)))}function P(t){return Symbol.for(t)}var y,A=function t(e){var n=this;n._currentContext=e?new Map(e):new Map,n.getValue=function(t){return n._currentContext.get(t)},n.setValue=function(e,r){var i=new t(n._currentContext);return i._currentContext.set(e,r),i},n.deleteValue=function(e){var r=new t(n._currentContext);return r._currentContext.delete(e),r}},b=new A,C={get:function(t,e){if(null!=t)return t[e]},keys:function(t){return null==t?[]:Object.keys(t)}},I={set:function(t,e,n){null!=t&&(t[e]=n)}},w=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},N=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},M=function(){function t(){}return t.prototype.active=function(){return b},t.prototype.with=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return e.call.apply(e,N([n],w(r),!1))},t.prototype.bind=function(t,e){return e},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),x=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},U=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},D="context",B=new M,j=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(t){return u(D,t,g.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return(r=this._getContextManager()).with.apply(r,U([t,e,n],x(i),!1))},t.prototype.bind=function(t,e){return this._getContextManager().bind(t,e)},t.prototype._getContextManager=function(){return c(D)||B},t.prototype.disable=function(){this._getContextManager().disable(),l(D,g.instance())},t}();!function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"}(y||(y={}));var X="0000000000000000",G="00000000000000000000000000000000",$={traceId:G,spanId:X,traceFlags:y.NONE},F=function(){function t(t){void 0===t&&(t=$),this._spanContext=t}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(t,e){return this},t.prototype.setAttributes=function(t){return this},t.prototype.addEvent=function(t,e){return this},t.prototype.setStatus=function(t){return this},t.prototype.updateName=function(t){return this},t.prototype.end=function(t){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(t,e){},t}(),V=P("OpenTelemetry Context Key SPAN");function k(t){return t.getValue(V)||void 0}function H(){return k(j.getInstance().active())}function z(t,e){return t.setValue(V,e)}function K(t){return t.deleteValue(V)}function Q(t,e){return z(t,new F(e))}function Y(t){var e;return null===(e=k(t))||void 0===e?void 0:e.spanContext()}var Z=/^([0-9a-f]{32})$/i,W=/^[0-9a-f]{16}$/i;function J(t){return Z.test(t)&&t!==G}function q(t){return J(t.traceId)&&(e=t.spanId,W.test(e)&&e!==X);var e}function tt(t){return new F(t)}var et=j.getInstance(),nt=function(){function t(){}return t.prototype.startSpan=function(t,e,n){if(void 0===n&&(n=et.active()),Boolean(null==e?void 0:e.root))return new F;var r,i=n&&Y(n);return"object"==typeof(r=i)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&q(i)?new F(i):new F},t.prototype.startActiveSpan=function(t,e,n,r){var i,o,s;if(!(arguments.length<2)){2===arguments.length?s=e:3===arguments.length?(i=e,s=n):(i=e,o=n,s=r);var a=null!=o?o:et.active(),u=this.startSpan(t,i,a),c=z(a,u);return et.with(c,s,void 0,u)}},t}();var rt,it,ot,st=new nt,at=function(){function t(t,e,n,r){this._provider=t,this.name=e,this.version=n,this.options=r}return t.prototype.startSpan=function(t,e,n){return this._getTracer().startSpan(t,e,n)},t.prototype.startActiveSpan=function(t,e,n,r){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):st},t}(),ut=new(function(){function t(){}return t.prototype.getTracer=function(t,e,n){return new nt},t}()),ct=function(){function t(){}return t.prototype.getTracer=function(t,e,n){var r;return null!==(r=this.getDelegateTracer(t,e,n))&&void 0!==r?r:new at(this,t,e,n)},t.prototype.getDelegate=function(){var t;return null!==(t=this._delegate)&&void 0!==t?t:ut},t.prototype.setDelegate=function(t){this._delegate=t},t.prototype.getDelegateTracer=function(t,e,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(t,e,n)},t}();!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(rt||(rt={})),function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"}(it||(it={})),function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"}(ot||(ot={}));var lt=j.getInstance(),_t=g.instance(),pt=function(){function t(){}return t.prototype.inject=function(t,e){},t.prototype.extract=function(t,e){return t},t.prototype.fields=function(){return[]},t}(),ht=P("OpenTelemetry Baggage Key");function Et(t){return t.getValue(ht)||void 0}function dt(){return Et(j.getInstance().active())}function ft(t,e){return t.setValue(ht,e)}function Tt(t){return t.deleteValue(ht)}var gt="propagation",Ot=new pt,Lt=function(){function t(){this.createBaggage=v,this.getBaggage=Et,this.getActiveBaggage=dt,this.setBaggage=ft,this.deleteBaggage=Tt}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(t){return u(gt,t,g.instance())},t.prototype.inject=function(t,e,n){return void 0===n&&(n=I),this._getGlobalPropagator().inject(t,e,n)},t.prototype.extract=function(t,e,n){return void 0===n&&(n=C),this._getGlobalPropagator().extract(t,e,n)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){l(gt,g.instance())},t.prototype._getGlobalPropagator=function(){return c(gt)||Ot},t}(),mt=Lt.getInstance(),St="trace",Rt=function(){function t(){this._proxyTracerProvider=new ct,this.wrapSpanContext=tt,this.isSpanContextValid=q,this.deleteSpan=K,this.getSpan=k,this.getActiveSpan=H,this.getSpanContext=Y,this.setSpan=z,this.setSpanContext=Q}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(t){var e=u(St,this._proxyTracerProvider,g.instance());return e&&this._proxyTracerProvider.setDelegate(t),e},t.prototype.getTracerProvider=function(){return c(St)||this._proxyTracerProvider},t.prototype.getTracer=function(t,e){return this.getTracerProvider().getTracer(t,e)},t.prototype.disable=function(){l(St,g.instance()),this._proxyTracerProvider=new ct},t}(),vt=Rt.getInstance();const Pt=P("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function yt(t){return!0===t.getValue(Pt)}const At="baggage";function bt(t){const e=t.split(";");if(e.length<=0)return;const n=e.shift();if(!n)return;const r=n.indexOf("=");if(r<=0)return;const i=decodeURIComponent(n.substring(0,r).trim()),o=decodeURIComponent(n.substring(r+1).trim());let s;var a;return e.length>0&&("string"!=typeof(a=e.join(";"))&&(R.error("Cannot create baggage metadata from unknown type: "+typeof a),a=""),s={__TYPE__:S,toString:function(){return a}}),{key:i,value:o,metadata:s}}class Ct{inject(t,e,n){const r=mt.getBaggage(t);if(!r||yt(t))return;const i=function(t){return t.getAllEntries().map((([t,e])=>{let n=`${encodeURIComponent(t)}=${encodeURIComponent(e.value)}`;return void 0!==e.metadata&&(n+=";"+e.metadata.toString()),n}))}(r).filter((t=>t.length<=4096)).slice(0,180),o=function(t){return t.reduce(((t,e)=>{const n=`${t}${""!==t?",":""}${e}`;return n.length>8192?t:n}),"")}(i);o.length>0&&n.set(e,At,o)}extract(t,e,n){const r=n.get(e,At),i=Array.isArray(r)?r.join(","):r;if(!i)return t;const o={};if(0===i.length)return t;return i.split(",").forEach((t=>{const e=bt(t);if(e){const t={value:e.value};e.metadata&&(t.metadata=e.metadata),o[e.key]=t}})),0===Object.entries(o).length?t:mt.setBaggage(t,mt.createBaggage(o))}fields(){return[At]}}function It(t){const e={};if("object"!=typeof t||null==t)return e;for(const[n,r]of Object.entries(t))wt(n)?Nt(r)?Array.isArray(r)?e[n]=r.slice():e[n]=r:_t.warn(`Invalid attribute value set for key: ${n}`):_t.warn(`Invalid attribute key: ${n}`);return e}function wt(t){return"string"==typeof t&&t.length>0}function Nt(t){return null==t||(Array.isArray(t)?function(t){let e;for(const n of t)if(null!=n){if(!e){if(Mt(n)){e=typeof n;continue}return!1}if(typeof n!==e)return!1}return!0}(t):Mt(t))}function Mt(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}let xt=t=>{_t.error(function(t){return"string"==typeof t?t:JSON.stringify(function(t){const e={};let n=t;for(;null!==n;)Object.getOwnPropertyNames(n).forEach((t=>{if(e[t])return;const r=n[t];r&&(e[t]=String(r))})),n=Object.getPrototypeOf(n);return e}(t))}(t))};function Ut(t){try{xt(t)}catch(t){}}var Dt;!function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"}(Dt||(Dt={}));const Bt="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},jt=",",Xt=["OTEL_SDK_DISABLED"];function Gt(t){return Xt.indexOf(t)>-1}const $t=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Ft(t){return $t.indexOf(t)>-1}const Vt=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function kt(t){return Vt.indexOf(t)>-1}const Ht=1/0,zt=128,Kt={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:_.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Ht,OTEL_ATTRIBUTE_COUNT_LIMIT:zt,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Ht,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:zt,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:Ht,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:zt,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:Dt.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};function Qt(t,e,n){if(void 0===n[t])return;const r=String(n[t]);e[t]="true"===r.toLowerCase()}function Yt(t,e,n,r=-1/0,i=1/0){if(void 0!==n[t]){const o=Number(n[t]);isNaN(o)||(e[t]=o<r?r:o>i?i:o)}}function Zt(t,e,n,r=jt){const i=n[t];"string"==typeof i&&(e[t]=i.split(r).map((t=>t.trim())))}const Wt={ALL:_.ALL,VERBOSE:_.VERBOSE,DEBUG:_.DEBUG,INFO:_.INFO,WARN:_.WARN,ERROR:_.ERROR,NONE:_.NONE};function Jt(t,e,n){const r=n[t];if("string"==typeof r){const n=Wt[r.toUpperCase()];null!=n&&(e[t]=n)}}function qt(t){const e={};for(const n in Kt){const r=n;if("OTEL_LOG_LEVEL"===r)Jt(r,e,t);else if(Gt(r))Qt(r,e,t);else if(Ft(r))Yt(r,e,t);else if(kt(r))Zt(r,e,t);else{const n=t[r];null!=n&&(e[r]=String(n))}}return e}function te(){const t=qt(Bt);return Object.assign({},Kt,t)}const ee=performance,ne="exception.type",re="exception.message",ie="exception.stacktrace",oe="service.name",se="telemetry.sdk.name",ae="telemetry.sdk.language",ue="telemetry.sdk.version",ce={[se]:"opentelemetry",["process.runtime.name"]:"browser",[ae]:"webjs",[ue]:"1.17.1"};const le=Math.pow(10,6),_e=Math.pow(10,9);function pe(t){const e=t/1e3;return[Math.trunc(e),Math.round(t%1e3*le)]}function he(){let t=ee.timeOrigin;if("number"!=typeof t){const e=ee;t=e.timing&&e.timing.fetchStart}return t}function Ee(t){return Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]}function de(t){return Ee(t)||"number"==typeof t||t instanceof Date}function fe(t,e){const n=[t[0]+e[0],t[1]+e[1]];return n[1]>=_e&&(n[1]-=_e,n[0]+=1),n}var Te;!function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"}(Te||(Te={}));class ge{constructor(t={}){var e;this._propagators=null!==(e=t.propagators)&&void 0!==e?e:[],this._fields=Array.from(new Set(this._propagators.map((t=>"function"==typeof t.fields?t.fields():[])).reduce(((t,e)=>t.concat(e)),[])))}inject(t,e,n){for(const r of this._propagators)try{r.inject(t,e,n)}catch(t){_t.warn(`Failed to inject with ${r.constructor.name}. Err: ${t.message}`)}}extract(t,e,n){return this._propagators.reduce(((t,r)=>{try{return r.extract(t,e,n)}catch(t){_t.warn(`Failed to inject with ${r.constructor.name}. Err: ${t.message}`)}return t}),t)}fields(){return this._fields.slice()}}const Oe="[_0-9a-z-*/]",Le=new RegExp(`^(?:${`[a-z]${Oe}{0,255}`}|${`[a-z0-9]${Oe}{0,240}@[a-z]${Oe}{0,13}`})$`),me=/^[ -~]{0,255}[!-~]$/,Se=/,|=/;class Re{constructor(t){this._internalState=new Map,t&&this._parse(t)}set(t,e){const n=this._clone();return n._internalState.has(t)&&n._internalState.delete(t),n._internalState.set(t,e),n}unset(t){const e=this._clone();return e._internalState.delete(t),e}get(t){return this._internalState.get(t)}serialize(){return this._keys().reduce(((t,e)=>(t.push(e+"="+this.get(e)),t)),[]).join(",")}_parse(t){t.length>512||(this._internalState=t.split(",").reverse().reduce(((t,e)=>{const n=e.trim(),r=n.indexOf("=");if(-1!==r){const i=n.slice(0,r),o=n.slice(r+1,e.length);(function(t){return Le.test(t)})(i)&&function(t){return me.test(t)&&!Se.test(t)}(o)&&t.set(i,o)}return t}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const t=new Re;return t._internalState=new Map(this._internalState),t}}const ve="traceparent",Pe="tracestate",ye=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");class Ae{inject(t,e,n){const r=vt.getSpanContext(t);if(!r||yt(t)||!q(r))return;const i=`00-${r.traceId}-${r.spanId}-0${Number(r.traceFlags||y.NONE).toString(16)}`;n.set(e,ve,i),r.traceState&&n.set(e,Pe,r.traceState.serialize())}extract(t,e,n){const r=n.get(e,ve);if(!r)return t;const i=Array.isArray(r)?r[0]:r;if("string"!=typeof i)return t;const o=function(t){const e=ye.exec(t);return e?"00"===e[1]&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}:null}(i);if(!o)return t;o.isRemote=!0;const s=n.get(e,Pe);if(s){const t=Array.isArray(s)?s.join(","):s;o.traceState=new Re("string"==typeof t?t:void 0)}return vt.setSpanContext(t,o)}fields(){return[ve,Pe]}}const be="[object Object]",Ce="[object Null]",Ie="[object Undefined]",we=Function.prototype.toString,Ne=we.call(Object),Me=(xe=Object.getPrototypeOf,Ue=Object,function(t){return xe(Ue(t))});var xe,Ue;const De=Object.prototype,Be=De.hasOwnProperty,je=Symbol?Symbol.toStringTag:void 0,Xe=De.toString;function Ge(t){if(!function(t){return null!=t&&"object"==typeof t}(t)||function(t){if(null==t)return void 0===t?Ie:Ce;return je&&je in Object(t)?function(t){const e=Be.call(t,je),n=t[je];let r=!1;try{t[je]=void 0,r=!0}catch(t){}const i=Xe.call(t);r&&(e?t[je]=n:delete t[je]);return i}(t):function(t){return Xe.call(t)}(t)}(t)!==be)return!1;const e=Me(t);if(null===e)return!0;const n=Be.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&we.call(n)===Ne}const $e=20;function Fe(t){return He(t)?t.slice():t}function Ve(t,e,n=0,r){let i;if(!(n>$e)){if(n++,Qe(t)||Qe(e)||ze(e))i=Fe(e);else if(He(t)){if(i=t.slice(),He(e))for(let t=0,n=e.length;t<n;t++)i.push(Fe(e[t]));else if(Ke(e)){const t=Object.keys(e);for(let n=0,r=t.length;n<r;n++){const r=t[n];i[r]=Fe(e[r])}}}else if(Ke(t))if(Ke(e)){if(!function(t,e){if(!Ge(t)||!Ge(e))return!1;return!0}(t,e))return e;i=Object.assign({},t);const o=Object.keys(e);for(let s=0,a=o.length;s<a;s++){const a=o[s],u=e[a];if(Qe(u))void 0===u?delete i[a]:i[a]=u;else{const o=i[a],s=u;if(ke(t,a,r)||ke(e,a,r))delete i[a];else{if(Ke(o)&&Ke(s)){const n=r.get(o)||[],i=r.get(s)||[];n.push({obj:t,key:a}),i.push({obj:e,key:a}),r.set(o,n),r.set(s,i)}i[a]=Ve(i[a],u,n,r)}}}}else i=e;return i}}function ke(t,e,n){const r=n.get(t[e])||[];for(let n=0,i=r.length;n<i;n++){const i=r[n];if(i.key===e&&i.obj===t)return!0}return!1}function He(t){return Array.isArray(t)}function ze(t){return"function"==typeof t}function Ke(t){return!Qe(t)&&!He(t)&&!ze(t)&&"object"==typeof t}function Qe(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||void 0===t||t instanceof Date||t instanceof RegExp||null===t}class Ye{constructor(){this._promise=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}get promise(){return this._promise}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}class Ze{constructor(t,e){this._callback=t,this._that=e,this._isCalled=!1,this._deferred=new Ye}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...t){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...t)).then((t=>this._deferred.resolve(t)),(t=>this._deferred.reject(t)))}catch(t){this._deferred.reject(t)}}return this._deferred.promise}}class We{constructor(t,e,n,r,i,o,s=[],a,u){this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:ot.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=n,this._spanContext=r,this.parentSpanId=o,this.kind=i,this.links=s;const c=Date.now();this._performanceStartTime=ee.now(),this._performanceOffset=c-(this._performanceStartTime+he()),this._startTimeProvided=null!=a,this.startTime=this._getTime(null!=a?a:c),this.resource=t.resource,this.instrumentationLibrary=t.instrumentationLibrary,this._spanLimits=t.getSpanLimits(),this._spanProcessor=t.getActiveSpanProcessor(),this._spanProcessor.onStart(this,e),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0}spanContext(){return this._spanContext}setAttribute(t,e){return null==e||this._isSpanEnded()?this:0===t.length?(_t.warn(`Invalid attribute key: ${t}`),this):Nt(e)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,t)?(this._droppedAttributesCount++,this):(this.attributes[t]=this._truncateToSize(e),this):(_t.warn(`Invalid attribute value set for key: ${t}`),this)}setAttributes(t){for(const[e,n]of Object.entries(t))this.setAttribute(e,n);return this}addEvent(t,e,n){if(this._isSpanEnded())return this;if(0===this._spanLimits.eventCountLimit)return _t.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(_t.warn("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),de(e)&&(de(n)||(n=e),e=void 0);const r=It(e);return this.events.push({name:t,attributes:r,time:this._getTime(n),droppedAttributesCount:0}),this}setStatus(t){return this._isSpanEnded()||(this.status=t),this}updateName(t){return this._isSpanEnded()||(this.name=t),this}end(t){this._isSpanEnded()?_t.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`):(this._ended=!0,this.endTime=this._getTime(t),this._duration=function(t,e){let n=e[0]-t[0],r=e[1]-t[1];return r<0&&(n-=1,r+=_e),[n,r]}(this.startTime,this.endTime),this._duration[0]<0&&(_t.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._spanProcessor.onEnd(this))}_getTime(t){if("number"==typeof t&&t<ee.now())return e=t+this._performanceOffset,fe(pe(he()),pe("number"==typeof e?e:ee.now()));var e;if("number"==typeof t)return pe(t);if(t instanceof Date)return pe(t.getTime());if(Ee(t))return t;if(this._startTimeProvided)return pe(Date.now());const n=ee.now()-this._performanceStartTime;return fe(this.startTime,pe(n))}isRecording(){return!1===this._ended}recordException(t,e){const n={};"string"==typeof t?n[re]=t:t&&(t.code?n[ne]=t.code.toString():t.name&&(n[ne]=t.name),t.message&&(n[re]=t.message),t.stack&&(n[ie]=t.stack)),n[ne]||n[re]?this.addEvent("exception",n,e):_t.warn(`Failed to record an exception ${t}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){return this._ended&&_t.warn(`Can not execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`),this._ended}_truncateToLimitUtil(t,e){return t.length<=e?t:t.substr(0,e)}_truncateToSize(t){const e=this._attributeValueLengthLimit;return e<=0?(_t.warn(`Attribute value limit must be positive, got ${e}`),t):"string"==typeof t?this._truncateToLimitUtil(t,e):Array.isArray(t)?t.map((t=>"string"==typeof t?this._truncateToLimitUtil(t,e):t)):t}}var Je;!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Je||(Je={}));class qe{shouldSample(){return{decision:Je.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class tn{shouldSample(){return{decision:Je.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class en{constructor(t){var e,n,r,i;this._root=t.root,this._root||(Ut(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new tn),this._remoteParentSampled=null!==(e=t.remoteParentSampled)&&void 0!==e?e:new tn,this._remoteParentNotSampled=null!==(n=t.remoteParentNotSampled)&&void 0!==n?n:new qe,this._localParentSampled=null!==(r=t.localParentSampled)&&void 0!==r?r:new tn,this._localParentNotSampled=null!==(i=t.localParentNotSampled)&&void 0!==i?i:new qe}shouldSample(t,e,n,r,i,o){const s=vt.getSpanContext(t);return s&&q(s)?s.isRemote?s.traceFlags&y.SAMPLED?this._remoteParentSampled.shouldSample(t,e,n,r,i,o):this._remoteParentNotSampled.shouldSample(t,e,n,r,i,o):s.traceFlags&y.SAMPLED?this._localParentSampled.shouldSample(t,e,n,r,i,o):this._localParentNotSampled.shouldSample(t,e,n,r,i,o):this._root.shouldSample(t,e,n,r,i,o)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}class nn{constructor(t=0){this._ratio=t,this._ratio=this._normalize(t),this._upperBound=Math.floor(4294967295*this._ratio)}shouldSample(t,e){return{decision:J(e)&&this._accumulate(e)<this._upperBound?Je.RECORD_AND_SAMPLED:Je.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(t){return"number"!=typeof t||isNaN(t)?0:t>=1?1:t<=0?0:t}_accumulate(t){let e=0;for(let n=0;n<t.length/8;n++){const r=8*n;e=(e^parseInt(t.slice(r,r+8),16))>>>0}return e}}const rn=te(),on=Dt.AlwaysOn,sn=1;function an(){return{sampler:un(rn),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:te().OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:te().OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:te().OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:te().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:te().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:te().OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:te().OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:te().OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT}}}function un(t=te()){switch(t.OTEL_TRACES_SAMPLER){case Dt.AlwaysOn:return new tn;case Dt.AlwaysOff:return new qe;case Dt.ParentBasedAlwaysOn:return new en({root:new tn});case Dt.ParentBasedAlwaysOff:return new en({root:new qe});case Dt.TraceIdRatio:return new nn(cn(t));case Dt.ParentBasedTraceIdRatio:return new en({root:new nn(cn(t))});default:return _t.error(`OTEL_TRACES_SAMPLER value "${t.OTEL_TRACES_SAMPLER} invalid, defaulting to ${on}".`),new tn}}function cn(t){if(void 0===t.OTEL_TRACES_SAMPLER_ARG||""===t.OTEL_TRACES_SAMPLER_ARG)return _t.error(`OTEL_TRACES_SAMPLER_ARG is blank, defaulting to ${sn}.`),sn;const e=Number(t.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(_t.error(`OTEL_TRACES_SAMPLER_ARG=${t.OTEL_TRACES_SAMPLER_ARG} was given, but it is invalid, defaulting to ${sn}.`),sn):e<0||e>1?(_t.error(`OTEL_TRACES_SAMPLER_ARG=${t.OTEL_TRACES_SAMPLER_ARG} was given, but it is out of range ([0..1]), defaulting to ${sn}.`),sn):e}function ln(t){var e,n,r,i,o,s,a,u,c,l,_,p;const h=Object.assign({},t.spanLimits),E="undefined"!=typeof process&&process&&process.env?qt(process.env):qt(Bt);return h.attributeCountLimit=null!==(s=null!==(o=null!==(i=null!==(n=null===(e=t.spanLimits)||void 0===e?void 0:e.attributeCountLimit)&&void 0!==n?n:null===(r=t.generalLimits)||void 0===r?void 0:r.attributeCountLimit)&&void 0!==i?i:E.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)&&void 0!==o?o:E.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==s?s:zt,h.attributeValueLengthLimit=null!==(p=null!==(_=null!==(l=null!==(u=null===(a=t.spanLimits)||void 0===a?void 0:a.attributeValueLengthLimit)&&void 0!==u?u:null===(c=t.generalLimits)||void 0===c?void 0:c.attributeValueLengthLimit)&&void 0!==l?l:E.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==_?_:E.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==p?p:Ht,Object.assign({},t,{spanLimits:h})}class _n{constructor(t,e){this._exporter=t,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;const n=te();this._maxExportBatchSize="number"==typeof(null==e?void 0:e.maxExportBatchSize)?e.maxExportBatchSize:n.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==e?void 0:e.maxQueueSize)?e.maxQueueSize:n.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==e?void 0:e.scheduledDelayMillis)?e.scheduledDelayMillis:n.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==e?void 0:e.exportTimeoutMillis)?e.exportTimeoutMillis:n.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new Ze(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(_t.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}onStart(t,e){}onEnd(t){this._shutdownOnce.isCalled||0!=(t.spanContext().traceFlags&y.SAMPLED)&&this._addToBuffer(t)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return Promise.resolve().then((()=>this.onShutdown())).then((()=>this._flushAll())).then((()=>this._exporter.shutdown()))}_addToBuffer(t){if(this._finishedSpans.length>=this._maxQueueSize)return 0===this._droppedSpansCount&&_t.debug("maxQueueSize reached, dropping spans"),void this._droppedSpansCount++;this._droppedSpansCount>0&&(_t.warn(`Dropped ${this._droppedSpansCount} spans because maxQueueSize reached`),this._droppedSpansCount=0),this._finishedSpans.push(t),this._maybeStartTimer()}_flushAll(){return new Promise(((t,e)=>{const n=[];for(let t=0,e=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);t<e;t++)n.push(this._flushOneBatch());Promise.all(n).then((()=>{t()})).catch(e)}))}_flushOneBatch(){return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise(((t,e)=>{const n=setTimeout((()=>{e(new Error("Timeout"))}),this._exportTimeoutMillis);lt.with(function(t){return t.setValue(Pt,!0)}(lt.active()),(()=>{const r=this._finishedSpans.splice(0,this._maxExportBatchSize),i=()=>this._exporter.export(r,(r=>{var i;clearTimeout(n),r.code===Te.SUCCESS?t():e(null!==(i=r.error)&&void 0!==i?i:new Error("BatchSpanProcessor: span export failed"))})),o=r.map((t=>t.resource)).filter((t=>t.asyncAttributesPending));0===o.length?i():Promise.all(o.map((t=>{var e;return null===(e=t.waitForAsyncAttributes)||void 0===e?void 0:e.call(t)}))).then(i,(t=>{Ut(t),e(t)}))}))}))}_maybeStartTimer(){if(this._isExporting)return;const t=()=>{this._isExporting=!0,this._flushOneBatch().then((()=>{this._isExporting=!1,this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())})).catch((t=>{this._isExporting=!1,Ut(t)}))};if(this._finishedSpans.length>=this._maxExportBatchSize)return t();void 0===this._timer&&(this._timer=setTimeout((()=>t()),this._scheduledDelayMillis),this._timer)}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}}class pn extends _n{constructor(t,e){super(t,e),this.onInit(e)}onInit(t){!0!==(null==t?void 0:t.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=()=>{"hidden"===document.visibilityState&&this.forceFlush()},this._pageHideListener=()=>{this.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))}onShutdown(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))}}class hn{constructor(){this.generateTraceId=dn(16),this.generateSpanId=dn(8)}}const En=Array(32);function dn(t){return function(){for(let e=0;e<2*t;e++)En[e]=Math.floor(16*Math.random())+48,En[e]>=58&&(En[e]+=39);return String.fromCharCode.apply(null,En.slice(0,2*t))}}class fn{constructor(t,e,n){this._tracerProvider=n;const r=function(t){const e={sampler:un()},n=an(),r=Object.assign({},n,e,t);return r.generalLimits=Object.assign({},n.generalLimits,t.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,t.spanLimits||{}),r}(e);this._sampler=r.sampler,this._generalLimits=r.generalLimits,this._spanLimits=r.spanLimits,this._idGenerator=e.idGenerator||new hn,this.resource=n.resource,this.instrumentationLibrary=t}startSpan(t,e={},n=lt.active()){var r,i,o;e.root&&(n=vt.deleteSpan(n));const s=vt.getSpan(n);if(yt(n)){_t.debug("Instrumentation suppressed, returning Noop Span");return vt.wrapSpanContext($)}const a=null==s?void 0:s.spanContext(),u=this._idGenerator.generateSpanId();let c,l,_;a&&vt.isSpanContextValid(a)?(c=a.traceId,l=a.traceState,_=a.spanId):c=this._idGenerator.generateTraceId();const p=null!==(r=e.kind)&&void 0!==r?r:it.INTERNAL,h=(null!==(i=e.links)&&void 0!==i?i:[]).map((t=>({context:t.context,attributes:It(t.attributes)}))),E=It(e.attributes),d=this._sampler.shouldSample(n,c,t,p,E,h);l=null!==(o=d.traceState)&&void 0!==o?o:l;const f={traceId:c,spanId:u,traceFlags:d.decision===rt.RECORD_AND_SAMPLED?y.SAMPLED:y.NONE,traceState:l};if(d.decision===rt.NOT_RECORD){_t.debug("Recording is off, propagating context in a non-recording span");return vt.wrapSpanContext(f)}const T=new We(this,n,t,f,p,_,h,e.startTime),g=It(Object.assign(E,d.attributes));return T.setAttributes(g),T}startActiveSpan(t,e,n,r){let i,o,s;if(arguments.length<2)return;2===arguments.length?s=e:3===arguments.length?(i=e,s=n):(i=e,o=n,s=r);const a=null!=o?o:lt.active(),u=this.startSpan(t,i,a),c=vt.setSpan(a,u);return lt.with(c,s,void 0,u)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}getActiveSpanProcessor(){return this._tracerProvider.getActiveSpanProcessor()}}class Tn{constructor(t,e){var n;this._attributes=t,this.asyncAttributesPending=null!=e,this._syncAttributes=null!==(n=this._attributes)&&void 0!==n?n:{},this._asyncAttributesPromise=null==e?void 0:e.then((t=>(this._attributes=Object.assign({},this._attributes,t),this.asyncAttributesPending=!1,t)),(t=>(_t.debug("a resource's async attributes promise rejected: %s",t),this.asyncAttributesPending=!1,{})))}static empty(){return Tn.EMPTY}static default(){return new Tn({[oe]:"unknown_service",[ae]:ce[ae],[se]:ce[se],[ue]:ce[ue]})}get attributes(){var t;return this.asyncAttributesPending&&_t.error("Accessing resource attributes before async attributes settled"),null!==(t=this._attributes)&&void 0!==t?t:{}}async waitForAsyncAttributes(){this.asyncAttributesPending&&await this._asyncAttributesPromise}merge(t){var e;if(!t)return this;const n=Object.assign(Object.assign({},this._syncAttributes),null!==(e=t._syncAttributes)&&void 0!==e?e:t.attributes);if(!this._asyncAttributesPromise&&!t._asyncAttributesPromise)return new Tn(n);const r=Promise.all([this._asyncAttributesPromise,t._asyncAttributesPromise]).then((([e,n])=>{var r;return Object.assign(Object.assign(Object.assign(Object.assign({},this._syncAttributes),e),null!==(r=t._syncAttributes)&&void 0!==r?r:t.attributes),n)}));return new Tn(n,r)}}Tn.EMPTY=new Tn({});class gn{constructor(t){this._spanProcessors=t}forceFlush(){const t=[];for(const e of this._spanProcessors)t.push(e.forceFlush());return new Promise((e=>{Promise.all(t).then((()=>{e()})).catch((t=>{Ut(t||new Error("MultiSpanProcessor: forceFlush failed")),e()}))}))}onStart(t,e){for(const n of this._spanProcessors)n.onStart(t,e)}onEnd(t){for(const e of this._spanProcessors)e.onEnd(t)}shutdown(){const t=[];for(const e of this._spanProcessors)t.push(e.shutdown());return new Promise(((e,n)=>{Promise.all(t).then((()=>{e()}),n)}))}}class On{onStart(t,e){}onEnd(t){}shutdown(){return Promise.resolve()}forceFlush(){return Promise.resolve()}}var Ln;!function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"}(Ln||(Ln={}));class mn{constructor(t={}){var e;this._registeredSpanProcessors=[],this._tracers=new Map;const n=function(...t){let e=t.shift();const n=new WeakMap;for(;t.length>0;)e=Ve(e,t.shift(),0,n);return e}({},an(),ln(t));this.resource=null!==(e=n.resource)&&void 0!==e?e:Tn.empty(),this.resource=Tn.default().merge(this.resource),this._config=Object.assign({},n,{resource:this.resource});const r=this._buildExporterFromEnv();if(void 0!==r){const t=new pn(r);this.activeSpanProcessor=t}else this.activeSpanProcessor=new On}getTracer(t,e,n){const r=`${t}@${e||""}:${(null==n?void 0:n.schemaUrl)||""}`;return this._tracers.has(r)||this._tracers.set(r,new fn({name:t,version:e,schemaUrl:null==n?void 0:n.schemaUrl},this._config,this)),this._tracers.get(r)}addSpanProcessor(t){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch((t=>_t.error("Error while trying to shutdown current span processor",t))),this._registeredSpanProcessors.push(t),this.activeSpanProcessor=new gn(this._registeredSpanProcessors)}getActiveSpanProcessor(){return this.activeSpanProcessor}register(t={}){vt.setGlobalTracerProvider(this),void 0===t.propagator&&(t.propagator=this._buildPropagatorFromEnv()),t.contextManager&&lt.setGlobalContextManager(t.contextManager),t.propagator&&mt.setGlobalPropagator(t.propagator)}forceFlush(){const t=this._config.forceFlushTimeoutMillis,e=this._registeredSpanProcessors.map((e=>new Promise((n=>{let r;const i=setTimeout((()=>{n(new Error(`Span processor did not completed within timeout period of ${t} ms`)),r=Ln.timeout}),t);e.forceFlush().then((()=>{clearTimeout(i),r!==Ln.timeout&&(r=Ln.resolved,n(r))})).catch((t=>{clearTimeout(i),r=Ln.error,n(t)}))}))));return new Promise(((t,n)=>{Promise.all(e).then((e=>{const r=e.filter((t=>t!==Ln.resolved));r.length>0?n(r):t()})).catch((t=>n([t])))}))}shutdown(){return this.activeSpanProcessor.shutdown()}_getPropagator(t){var e;return null===(e=this.constructor._registeredPropagators.get(t))||void 0===e?void 0:e()}_getSpanExporter(t){var e;return null===(e=this.constructor._registeredExporters.get(t))||void 0===e?void 0:e()}_buildPropagatorFromEnv(){const t=Array.from(new Set(te().OTEL_PROPAGATORS)),e=t.map((t=>{const e=this._getPropagator(t);return e||_t.warn(`Propagator "${t}" requested through environment variable is unavailable.`),e})).reduce(((t,e)=>(e&&t.push(e),t)),[]);return 0===e.length?void 0:1===t.length?e[0]:new ge({propagators:e})}_buildExporterFromEnv(){const t=te().OTEL_TRACES_EXPORTER;if("none"===t||""===t)return;const e=this._getSpanExporter(t);return e||_t.error(`Exporter "${t}" requested through environment variable is unavailable.`),e}}mn._registeredPropagators=new Map([["tracecontext",()=>new Ae],["baggage",()=>new Ct]]),mn._registeredExporters=new Map;class Sn{constructor(){this._enabled=!1,this._currentContext=b}_bindFunction(t=b,e){const n=this,r=function(...r){return n.with(t,(()=>e.apply(this,r)))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:e.length}),r}active(){return this._currentContext}bind(t,e){return void 0===t&&(t=this.active()),"function"==typeof e?this._bindFunction(t,e):e}disable(){return this._currentContext=b,this._enabled=!1,this}enable(){return this._enabled||(this._enabled=!0,this._currentContext=b),this}with(t,e,n,...r){const i=this._currentContext;this._currentContext=t||b;try{return e.call(n,...r)}finally{this._currentContext=i}}}class Rn extends mn{constructor(t={}){if(super(t),t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor"}register(t={}){void 0===t.contextManager&&(t.contextManager=new Sn),t.contextManager&&t.contextManager.enable(),super.register(t)}}const vn="0000000000000000";class Pn{generateTraceId(){return function(t){const e=Math.floor(Date.now()/1e3).toString(16),n=t(8),r=t(3);return"f5"+r+e+n}(An)}generateSpanId(){return function(t){const e=t(8);if(e===X)return vn;return e}(An)}}const yn=Array(32);function An(t){for(let e=0;e<2*t;e++)yn[e]=Math.floor(16*Math.random())+48,yn[e]>=58&&(yn[e]+=39);return String.fromCharCode.apply(null,yn.slice(0,2*t))}class bn{constructor(t){this.init()}init(){return t(this,void 0,void 0,(function*(){new Rn({idGenerator:new Pn,resource:new Tn({sdkVersion:"1.0.0",timeOrigin:performance.timeOrigin})}).register({})}))}}let Cn=null,In=()=>{};window.__POWERED_BY_QIANKUN__?console.info("DUOTEL initialization in sub-application is not supported"):In=(t={})=>Cn||(Cn=new bn(t),Cn);export{bn as default,In as init};
